<template>
    <div class="vgl-posts vgl-container">
        <h2 class="posts-heading" v-if="heading != ' '">{{ heading }}</h2>
        <masonry :cols="{default: colCount, 1023: 1}" :gutter="100" v-if="gridStyle == 'masonry'">
            <div v-for="(post, index) in updatedPosts" :key="post.id" :class="['vgl-post']">
                <div :class="['featured-image', 'index'+ index]">
                    <div :style="{ 'background-image': 'url(' + post.featured_url + ')' }"><a :href="post.permalink"></a></div>
                </div>
                <div :class="['vgl-post-info', 'index' + index]">
                    <a :href="post.permalink"><h3 class="title" v-html="post.title"></h3></a>
                    <div class="vgl-post-info__excerpt"><span>{{ post.excerpt }}</span></div>
                    <span class="vgl-post-info__author"><b>by</b> <span class="author">{{ post.authorName }}</span> | <span class="category">{{ post.category }}</span></span>
                    <a class="vgl-post-info__more read_more" :href="post.permalink">READ MORE</a>
                </div>
            </div>
        </masonry>
        <div v-else-if="gridStyle == 'list'">
            <div v-for="post in updatedPosts" :key="post.id" class="vgl-post">
                <div class="featured-image">
                    <div :style="{ 'background-image': 'url(' + post.featured_url + ')' }"><a :href="post.permalink"></a></div>
                </div>
                <div class="post-info">
                    <a :href="post.permalink"><p class="title" v-html="post.title"></p></a>
                    <div class="vgl-post-info__excerpt"><span>{{ post.excerpt }}</span></div>
                    <span class="name_category"><b>by</b> <span class="author">{{ post.authorName }}</span> | <span class="category">{{ post.category }}</span></span>
                    <a class="read_more" :href="post.permalink">READ MORE</a>
                </div>
            </div>
        </div>
        <a class="vgl-loadmorebtn" v-if="showLoadMore" @click="loadMoreClicked()" :class="[{'active': isActive}]">{{ loadMoreText }}</a>
    </div>
</template>
    
<script>
    // import VueMasonry from 'vue-masonry-css';

    export default {
        name: "PostsGrid",
        components: {
            // VueMasonry
        },
        props: {
            posts: {
                type: Array,
                required: true
            },
            startIndex: {
                type: Number,
                required: true
            },
            count: {
                type: Number,
                required: true
            },
            colCount: {
                type: Number,
                required: true
            },
            gridStyle: {
                type: Number,
                required: true
            },
            heading: {
                type: String,
                required: true
            },
            showLoadMore: {
                type: Boolean,
                required: false
            },
            loadMoreText: {
                type: String,
                required: false
            },
            order: {
                type: String,
                required: false
            },
            orderBy: {
                type: String,
                required: false
            }
        },
        data: function() {
            return {
                index: this.startIndex + this.count,
                updatedPosts: this.posts,
                isActive: false,
                loadMorePostCount: 12,
                postIndex: 0
            }
        },
        methods: {
            loadMoreClicked: function() {
                this.isActive = true;

                window.jQuery.post( 
                    window.ajaxurl,
                    {
                        action: 'vgl_loadmore_posts',
                        data: {
                            startIndex: this.index,
                            order: this.order,
                            orderBy: this.orderBy,
                            count: this.loadMorePostCount
                        }
                    },
                    {
                        headers: {
                            'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',
                            'Accept': 'text/html, */*; q=0.01'
                        }
                    }
                )
                .success( response => { JSON.parse(response).forEach( ele => this.updatedPosts.push(ele) ); this.index = this.index + this.loadMorePostCount; });
            }
        },
        computed: {

        },
        mounted: function() {
            
        }
    };
</script>

<style lang="scss">
    
    .vgl-posts {
        a {
            text-decoration: none;
        }
    }

    .vgl-posts.masonry {

        .vgl-post {
            margin-bottom: 100px;

            .featured-image {
                width: 100%;

                > div {
                    position: relative;
                    padding-top: calc(100% / 16 * 10);
                    background-size: cover;
                    background-repeat: no-repeat;
                    background-position: center;
                    transition: all 1.5s;
                    -webkit-transition: all 1.5s;

                    a {
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        z-index: 1;
                    }

                    &:after {
                        content: "";
                        position: absolute;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                        background: black;
                        opacity: 0;
                        transition: all 1.5s;
                        -webkit-transition: all 1.5s;
                    }

                    &:hover {
                        &:after {
                            opacity: 0.5;
                        }
                    }
                }

                &.index0 > div {
                    padding-top: 150%;
                }

                &.index1 {
                    @media screen and (min-width: 1024px) {
                        padding-top: 100px;
                    }

                    > div {
                        padding-top: 100%;
                    }
                }

                &.index2 > div {
                    padding-top: 50%;
                }

                &.index3 > div {
                    padding-top: 100%;
                }
            }

            img {
                object-fit: cover;
            }

            &::before,
            &::after {
                content: none;
                display: none;
            }

            .vgl-post-info__author {
                b {
                    color: #000;
                    font-weight: normal;
                }

                .author {
                    text-transform: capitalize;
                    color: #424242;
                }

                .category {
                    text-transform: uppercase;
                }
            }

            .vgl-post-info {
                margin-top: 20px;

                .title {
                    font-family: SportingGrotesque;
                    font-size: 30px;
                    font-weight: bold;
                    font-stretch: normal;
                    font-style: normal;
                    line-height: 1.37;
                    letter-spacing: normal;
                    color: #000000;
                }

                &.index0 {
                    .title {
                        @media screen and (min-width: 1024px) {
                            font-size: 52px;
                        }
                    }
                }

                > span {
                    font-family: Lato;
                    font-size: 14px;
                    font-weight: 500;
                    font-stretch: normal;
                    font-style: normal;
                    line-height: normal;
                    letter-spacing: normal;
                    color: #424242;
                    display: block;
                    font-weight: bold;
                }

                > a.read_more {
                    font-family: Lato;
                    font-size: 16px;
                    line-height: 19px;
                    font-weight: 400;
                    font-stretch: normal;
                    font-style: normal;
                    line-height: normal;
                    letter-spacing: normal;
                    color: #000000;
                    display: inline-block;
                    margin-top: 13px;
                    text-decoration: underline;
                }

                .vgl-post-info__excerpt {
                    margin: 12px 0px;
                    font-size: 16px;
                    line-height: 19px;

                    span, b, p {
                      font-family: Muli;
                    }
                }
            }

            @media screen and (max-width: 1023px) {
                margin-bottom: 50px;
            }
        }

        @media screen and (max-width: 768px) {
            margin-top: 69px;
        }
    }

    .vgl-posts.list {
        position: relative;
        margin-left: 15px;
        margin-right: 15px;

        .posts-heading {
            font-size: 42px;
            font-weight: normal;
            font-stretch: normal;
            font-style: normal;
            line-height: 1.37;
            letter-spacing: normal;
            color: #000000;
            position: relative;
            margin-bottom: 30px;
            z-index: 100;
            top: 0;
            left: 0;

            @media screen and (max-width: 768px) {
                position: relative;
                max-width: 350px;
                margin-left: auto;
                margin-right: auto;
                font-size: 42px;
                transform: none;
                text-align: center;
                margin-bottom: 40px;
            }
        }
        
        .vgl-post{
            margin-bottom: 50px;

            &:before,
            &:after {
                content: '';
                display: table;
                clear: both;
            }

            .featured-image {
                width: 50%;
                float: left;
                padding-right: 15px;
                position: relative;

                > div {
                    padding-top: calc(100% / 16 * 8);
                    background-size: cover;
                    background-repeat: no-repeat;
                    background-position: center;
                    transition: all 1.5s;
                    -webkit-transition: all 1.5s;

                    a {
                        position: absolute;
                        top: 0;
                        left: 0;
                        right: 0;
                        bottom: 0;
                        z-index: 1;
                    }

                    &:after {
                        content: "";
                        position: absolute;
                        top: 0;
                        left: 0;
                        width: calc(100% - 15px);
                        height: 100%;
                        background: black;
                        opacity: 0;
                    }

                    &:hover {
                        &:after {
                            opacity: 0.5;
                        }
                    }
                }

                @media screen and (max-width: 768px) {
                    width: 100%;
                    float: none;
                    padding-right: 0;
                }
            }

            .post-info {
                width: 50%;
                float: left;
                padding-left: 15px;

                .title {
                    font-size: 28px;
                    font-weight: 800;
                    font-stretch: normal;
                    font-style: normal;
                    line-height: normal;
                    letter-spacing: normal;
                    color: #000000;
                    margin-top: 0;
                    margin-bottom: 0;
                }

                .name_category {
                    font-size: 14px;
                    font-weight: 300;
                    font-stretch: normal;
                    font-style: normal;
                    line-height: normal;
                    letter-spacing: normal;
                    color: #424242;
                    display: block;
                    margin-top: 10px;
                    margin-bottom: 28px;

                    b {
                        color: #000;
                    }

                    .author {
                        text-transform: capitalize;
                        color: #424242;
                    }

                    .category {
                        text-transform: uppercase;
                    }
                }

                .read_more {
                    font-size: 16px;
                    font-weight: normal;
                    font-stretch: normal;
                    font-style: normal;
                    line-height: normal;
                    letter-spacing: normal;
                    color: #000000;
                    text-transform: uppercase;
                    text-decoration: underline;
                }

                .vgl-post-info__excerpt {
                    margin: 10px 0px;
                }

                @media screen and (max-width: 768px) {
                    width: 100%;
                    float: none;
                    padding-left: 0;
                    padding-top: 10px;

                    .name_category {
                        margin-bottom: 28px;
                    }

                    .read_more {
                        font-weight: 400;
                        text-decoration: underline;
                    }
                }
            }
        }

        @media screen and (max-width: 768px) {
            position: relative;
            padding-left: 0px;
            padding-right: 0px;
            margin-right: -30px;
            margin-left: 0px;

            .vgl-post {
                margin-bottom: 60px;
            }
        }
    }

    .vgl-posts {
        .vgl-loadmorebtn {
            position: relative;
            font-family: SportingGrotesque;
            font-size: 24px;
            font-weight: normal;
            font-stretch: normal;
            font-style: normal;
            line-height: 24px;
            letter-spacing: normal;
            text-align: center;
            color: #000000;
            border: solid 1px #000000;
            background-color: #fff1d6;
            display: block;
            padding: 20px 30px 15px 30px;
            margin-left: auto;
            margin-right: auto;
            cursor: pointer;
            max-width: 400px;
            box-shadow: 5px 5px 0px #000;
            transition: all ease-in-out .2s;
            left: 30%;

            &:hover {
                transform: translate(6px, 6px);
                border-width: 1px;
                box-shadow: 1px 2px 0 #000;
            }

            &.active {

            }
        }

        @media screen and (max-width: 1023px) {
            .vgl-loadmorebtn {
                left: 33%;
            }
        }

        @media screen and (max-width: 768px) {
            .vgl-loadmorebtn {
                left: 0;
                right: 0;
                margin: 0 auto;
            }
        }
    }

</style>
